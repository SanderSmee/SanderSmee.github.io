<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Documenting spring restcontrollers with spring-restdocs is a sure way to get great documentation. It allows one to document API endpoints based on examples used in a test, and document specific fields in a response. It&amp;#8217;s even possible to document additional attributes of a field in a JSON response."><meta name="author" content="Sander Smeman"><meta property="og:title" content="Custom, optional attributes in spring-restdocs"><meta property="og:description" content="Documenting spring restcontrollers with spring-restdocs is a sure way to get great documentation. It allows one to document API endpoints based on examples used in a test, and document specific fields in a response. It&amp;#8217;s even possible to document additional attributes of a field in a JSON response."><meta property="og:site_name" content="thoughts.tostring();"><meta property="og:type" content="article"><meta property="og:image" content="http://thoughts.tostring.bloghttps://source.unsplash.com/dC6Pb2JdAqs"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@@osusso"><meta name="twitter:image" content="http://thoughts.tostring.bloghttps://source.unsplash.com/dC6Pb2JdAqs"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com"><link rel="dns-prefetch" href="//use.fontawesome.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><title>Custom, optional attributes in spring-restdocs - thoughts.toString();</title><script type="text/javascript"></script><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous"><link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css"><link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/vs2015.min.css" rel="stylesheet"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script"),ga("create","UA-8287349-4","auto"),ga("send","pageview")</script></head><body><nav class="navbar navbar-default navbar-custom navbar-fixed-top"><div class="container-fluid"><div class="navbar-header page-scroll"><button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="/">thoughts.toString();</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"><ul class="nav navbar-nav navbar-right"><li><a href="/about">About</a></li><li><a href="/archives">Archive</a></li><li><a href="https://github.com/SanderSmee/sandersmee.github.io">Github</a></li></ul></div></div></nav><header class="intro-header" style="background-image:url(https://source.unsplash.com/dC6Pb2JdAqs)"><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="post-heading"><h1>Custom, optional attributes in spring-restdocs</h1><span class="meta"><span class="meta__item">2019-03-20 </span><span class="meta__item">3 minutes read</span></span></div></div></div></div></header><article><div class="container"><div class="row"><div class="col-lg-4 col-lg-offset-2 col-md-5 col-md-offset-1 post-tags"><a href="/tags/asciidoc/">#asciidoc</a> <a href="/tags/documentation/">#documentation</a> <a href="/tags/spring-restdocs/">#spring-restdocs</a></div><div class="col-lg-4 col-md-5 post-categories"><a href="/category/Howto/">Howto</a></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><div class="paragraph"><p>Documenting spring restcontrollers with spring-restdocs is a sure way to get great documentation. It allows one to document API endpoints based on examples used in a test, and document specific fields in a response. It&#8217;s even possible to document additional attributes of a field in a JSON response.</p></div><a id="more"></a><div class="paragraph"><p>Here, from the <a href="https://docs.spring.io/spring-restdocs/docs/2.0.3.RELEASE/reference/html5/#documenting-your-api-customizing" target="_blank" rel="noopener">documentation</a>, is added the attribute <code>constraints</code>, but with one caveat: it&#8217;s missing for one field:</p></div><div class="listingblock"><div class="title">Listing 1. Spring @WebMvcTest with spring-restdocs</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">.andDo(document("create-user", requestFields(
	attributes(key("title").value("Fields for user creation")),
	fieldWithPath("name").description("The user's name")
		.attributes(key("constraints")
			.value("Must not be null. Must not be empty")),
    fieldWithPath("age").description("The user's age"), <i class="conum" data-value="1"></i><b>(1)</b>
	fieldWithPath("email").description("The user's email address")
		.attributes(key("constraints")
			.value("Must be a valid email address")))));</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>An extra field, but without added documentation for the <code>constraints</code> attribute.</td></tr></table></div><div class="sect1"><h2>Include the attribute in the documentation</h2><div class="sectionbody"><div class="paragraph"><p>By default those additional attributes don&#8217;t appear in the generated documents. For that to happen, you have to override the spring-restdocs snippets, by placing a snippet on the test-classpath. In standard project structure this is done, by putting those snippets in <code>src/test/resources/org/springframework/restdocs/templates/asciidoctor</code> per the documentation.</p></div><div class="paragraph"><p>For the request fields, that snippet is then:</p></div><div class="listingblock"><div class="title">Listing 2. request-fields.snippet</div><div class="content"><pre class="highlightjs highlight"><code class="language-mustache hljs" data-lang="mustache">.{{title}}
|===
|Path|Type|Description|Constraints

{{ #fields }}
|{{path}}
|{{type}}
|{{description}}
|{{constraints}}

{{ /fields }}
|===</code></pre></div></div><div class="paragraph"><p>But running this test results in an failure reporting that the added attribute is not present:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">org.springframework.restdocs.mustache.MustacheException$Context: No method or field with name 'constraints' on line 9</code></pre></div></div><div class="paragraph"><p>This can be a convenient reminder that you have not completely documented the fields, but if you deliberately omitted the <code>constraint</code> attribute you wouldn&#8217;t want the failure.</p></div></div></div><div class="sect1"><h2>Solution</h2><div class="sectionbody"><div class="paragraph"><p>To provide a solution for the above problem, I had to search through the reported issues in the spring-restdocs <a href="https://github.com/spring-projects/spring-restdocs/" target="_blank" rel="noopener">github issues</a> to find the solution:</p></div><div class="listingblock"><div class="title">Listing 3. request-fields.snippet with adjustment</div><div class="content"><pre class="highlightjs highlight"><code class="language-mustache hljs" data-lang="mustache">.{{title}}
|===
|Path|Type|Description|Constraints

{{ #fields }}
|{{path}}
|{{type}}
|{{description}}
|{{ #constraints }}{{.}}{{ /constraints }} <i class="conum" data-value="1"></i><b>(1)</b>

{{ /fields }}

|===</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Different mustache notation for the constraints attribute</td></tr></table></div><div class="paragraph"><p>This uses the mustache <code>.</code> <a href="https://github.com/samskivert/jmustache#this" target="_blank" rel="noopener">special variable</a>. <code>&num;constraints</code> is now treated as a context, and evaluates to false when absent, or an empty list. But when a value is present, it evaluates and renders that value, which is then referenced as <code>this</code> by the <code>.</code>. This might be better explained in the <a href="https://github.com/spring-projects/spring-restdocs/issues/291#issuecomment-433998972" target="_blank" rel="noopener">comments</a> of issue &num;291 .</p></div></div></div></div><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"></div></div></div></article><hr><footer><div class="container"><div class="row"><div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1"><ul class="list-inline text-center"><li><a href="https://twitter.com/osusso" target="_blank"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-twitter fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://github.com/sandersmee/sandersmee.github.io" target="_blank"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-github fa-stack-1x fa-inverse"></i></span></a></li><li><a href="https://www.linkedin.com/in/sandersmeman/" target="_blank"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i> <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i></span></a></li><li><a href="mailto:sander.smeman@gmail.com" target="_blank"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span></a></li><li><a href="/atom.xml" target="_blank"><span class="fa-stack fa-lg"><i class="fas fa-circle fa-stack-2x"></i> <i class="fas fa-rss fa-stack-1x fa-inverse"></i></span></a></li></ul><p class="copyright text-muted">&copy; 2019 Sander Smeman<br></p><p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p></div></div></div></footer><script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script></body></html>